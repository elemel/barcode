#!/usr/bin/env python3

import sys

from quest.assembler import assemble
from quest.process import Process


def main():
    assembly_code = open(sys.argv[1]).read()
    machine_code = assemble(assembly_code)

    process = Process(machine_code, sys.argv[2:])

    if not sys.stdin.isatty():
        process.write(sys.stdin.read())

    process.close()
    process.run()

    while True:
        line = process.read_line()

        if not line:
            break

        print(line, end='')


if __name__ == '__main__':
    main()
